<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Inter-Hostel Badminton Fixtures (Live)</title>
<script type="module">
/* ----------  Firebase imports  ---------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import {
  getFirestore, doc, getDoc, setDoc, onSnapshot
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

/* ----------  Replace this with YOUR CONFIG  ---------- */
const firebaseConfig = {

    apiKey: "AIzaSyAYEBi37iNUdsTzoAmuh47phNJkjD0245w",

    authDomain: "badminton-fixtures-5610f.firebaseapp.com",

    projectId: "badminton-fixtures-5610f",

    storageBucket: "badminton-fixtures-5610f.firebasestorage.app",

    messagingSenderId: "296007773773",

    appId: "1:296007773773:web:f59d1804da15464f587604",

    measurementId: "G-7T6Q002VRS"

  };
const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

/* ----------  Page elements  ---------- */
const bracketEl = document.getElementById("bracket");
const teamsEl   = document.getElementById("teams");
const pwEl      = document.getElementById("pw");
const adminBox  = document.getElementById("adminBox");

let admin=false;
const docRef = doc(db,"fixtures","main");

/* ----------  Listen live from Firestore  ---------- */
onSnapshot(docRef,(snap)=>{
  if(!snap.exists()){ bracketEl.innerHTML="<p>No fixture yet</p>"; return; }
  const data=snap.data();
  renderBracket(data);
});

/* ----------  Generate bracket  ---------- */
async function generate(){
  if(!admin) return alert("Admin only");
  const lines=teamsEl.value.trim().split("\\n").filter(x=>x);
  if(lines.length<2) return alert("Need 2+ teams");
  const matches=[];
  for(let i=0;i<lines.length;i+=2){
    matches.push({a:lines[i],b:lines[i+1]||'BYE',winner:null});
  }
  await setDoc(docRef,{teams:lines,matches});
}

/* ----------  Set winner  ---------- */
async function setWinner(idx,w){
  if(!admin) return;
  const snap=await getDoc(docRef);
  const data=snap.data();
  data.matches[idx].winner=w;
  await setDoc(docRef,data);
}

/* ----------  Render function  ---------- */
function renderBracket(data){
  bracketEl.innerHTML="";
  data.matches.forEach((m,i)=>{
    const div=document.createElement("div");
    div.className="match";
    div.innerHTML=`<strong>${m.a}</strong> vs <strong>${m.b}</strong> 
      <span>${m.winner? 'ğŸ† '+m.winner : ''}</span>`;
    if(admin){
      div.onclick=()=>setWinner(i,prompt(`Winner? A or B\\nA:${m.a}\\nB:${m.b}`)==='A'?m.a:m.b);
    }
    bracketEl.appendChild(div);
  });
}

/* ----------  Admin login ---------- */
window.login=()=>{
  const pass=pwEl.value.trim();
  if(pass==="admin123"){ admin=true; adminBox.style.display='block'; alert("Logged in"); }
  else alert("Wrong password");
};
window.generate=generate;
</script>

<style>
body{font-family:sans-serif;background:#f7f9fc;margin:20px;}
.match{background:#fff;padding:10px;margin:6px 0;border-radius:6px;box-shadow:0 1px 3px #ccc;cursor:pointer;}
textarea{width:100%;min-height:120px;}
button{padding:8px 12px;margin:4px;}
</style>
</head>

<body>
<h2>ğŸ¸ Inter-Hostel Badminton Fixtures (Live)</h2>
<div id="bracket">Loadingâ€¦</div>

<hr>
<div id="adminLogin">
  <input id="pw" type="password" placeholder="Admin password">
  <button onclick="login()">Login</button>
</div>

<div id="adminBox" style="display:none">
  <h3>Admin Panel</h3>
  <textarea id="teams" placeholder="Enter team names (one per line)"></textarea><br>
  <button onclick="generate()">Generate Fixtures</button>
</div>
</body>
</html>
